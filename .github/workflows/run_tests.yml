name: Run multicorn2 Tests

on:
  pull_request:
  push:
    branches:
      - 'main'

jobs:
  run_tests:
    name: run tests
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - uses: cachix/install-nix-action@v26
      # FIXME: Add a nix binary cache that builds, pushes, and pulles the .#allPostgresWithPlPython target so that this
      # build doesn't take 15 minutes... but do it in a way that doesn't require secrets to be exposed to the untrusted
      # pull request workflow because GitHub (wisely) doesn't support that.
      - run: nix build .#allTestSuites
